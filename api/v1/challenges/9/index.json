{"success": true, "data": {"id": 9, "name": "Bootkit", "value": 500, "description": "Many years later, in a galaxy far far away, the Empire of UIUCTF was collecting UEFI patches for their secret lab machines, and stumbled upon the remains of SIGPwny Inc. and PwnySIG Inc. Not knowing the dangers, they installed both patch sets to their super secure lab machines, with TPM-sealed disk encryption protecting their latest research (flag).\n\nAs the lead security officer of the rebellion against the Empire, you need their research to expose the Empire of their anti-droid vendetta. Unfortunately, you discovered that the Empire designed the secret disks such that they detach themselves as soon as any keyboard input is detected during boot, and since you need the keyboard to install the bootkit, the bootkit must survive the reboot. TPM also hashes everything on the boot disk and there's no hope of keeping the bootkit there.\n\nThat leaves only one option, completely and utterly pwning the firmware...\n\nLua.efi, but with persistance. SMM is Asleep, but with purpose.\n\n`$ socat file:$(tty),raw,echo=0 openssl:bootkit.chal.uiuc.tf:1337`\n\n<details><summary>Show hint #1</summary>UEFIReplace from https://github.com/LongSoft/UEFITool/tree/old_engine is\n  installed remotely in the initramfs, so you don't need to transfer\n  megabytes of data though serial.</details>\n\n<details><summary>Show hint #2</summary>Command entered into /proc/sys/kernel/run_command will be run by initrd.\n  Without, one could spawn processes by writing to kernel data structs\n  (or modprobe_path I guess) since you have arbitrary kernel write anyways...</details>\n\n<details><summary>Show hint #3</summary>KASLR is off. With KASLR one could just easily compute the offset from the\n  call stack.</details>\n\n<details><summary>Show hint #4</summary>PCR 0 and 1 are not measured. If they were, one could feed TPM with fake\n  hashes since system boot, considering you have arbitrary CFI flash write\n  anyways... I mean, who said the hashes has to be of a real blob?\n  [<a href=\"https://github.com/tianocore/edk2/blob/8be9a344d35316fb0ee70a33779a7a931fcb8a1d/SecurityPkg/Library/Tpm2CommandLib/Tpm2Integrity.c#L92\" target=\"_blank\" rel=\"noopener noreferrer\">1</a>]\n  [<a href=\"https://github.com/stefanberger/libtpms/blob/7dfe310f06cc188187807d36e4786458e3e14e86/src/tpm2/IntegrityCommands.c#L66\" target=\"_blank\" rel=\"noopener noreferrer\">2</a>]\n  [<a href=\"https://github.com/microsoft/ms-tpm-20-ref/blob/ee21db0a941decd3cac67925ea3310873af60ab3/TPMCmd/tpm/src/command/PCR/PCR_Extend.c\" target=\"_blank\" rel=\"noopener noreferrer\">3</a>]\n  [<a href=\"https://github.com/tpm2-software/tpm2-tools/blob/112f0e547a7a83d625b585e506449a185e9268cc/man/tpm2_pcrextend.1.md\" target=\"_blank\" rel=\"noopener noreferrer\">4</a>]\n  [<a href=\"https://trustedcomputinggroup.org/wp-content/uploads/Trusted-Platform-Module-2.0-Library-Part-3-Version-184_pub.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">5</a>, Section 22.2]\n</details>\n\n**author**: YiFei Zhu", "attribution": "", "connection_info": null, "next_id": null, "category": "pwn", "state": "visible", "max_attempts": 0, "type": "dynamic", "type_data": {"id": "dynamic", "name": "dynamic", "templates": {"create": "/plugins/dynamic_challenges/assets/create.html", "update": "/plugins/dynamic_challenges/assets/update.html", "view": "/plugins/dynamic_challenges/assets/view.html"}, "scripts": {"create": "/plugins/dynamic_challenges/assets/create.js", "update": "/plugins/dynamic_challenges/assets/update.js", "view": "/plugins/dynamic_challenges/assets/view.js"}}, "initial": 500, "decay": 75, "minimum": 50, "function": "logarithmic", "solves": 0, "solved_by_me": false, "attempts": 0, "files": ["/files/b19107423e272aea8b88d2c6874f2a59/README", "/files/38c2c5b227cd51d4066f9de76b44b2ea/chal_build.tar.zst", "/files/d35e21ac35d29459bd9865ca5f879e0e/edk2_artifacts.tar.zst", "/files/2609db59107ad05cfdebc51505174e00/linux-headers.tar.zst", "/files/58d066d46be6e9d060795870ce3b5f20/run.tar.zst", "/files/976eefc56c7ecf084a61d79956672722/vmlinux.zst"], "tags": ["pwn", "uefi", "extreme"], "hints": [], "view": "<div :class=\"getStyles()\" role=\"document\" x-data=\"Challenge\" x-init=\"id = 9; max_attempts = 0; attempts = 0\">\n  <div class=\"modal-content\">\n    <div class=\"modal-body py-4 px-4 px-sm-5\">\n\n      <div>\n        <button type=\"button\" class=\"btn-close float-end\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n\n        <ul class=\"nav nav-tabs\">\n          <li class=\"nav-item\">\n            <button class=\"nav-link active\" data-bs-target=\"#challenge\" @click=\"showChallenge()\">\n              Challenge\n            </button>\n          </li>\n\n          \n            <li class=\"nav-item\">\n              <button class=\"nav-link challenge-solves\" data-bs-target=\"#solves\" @click=\"showSolves()\">\n                \n                  0 Solves\n                \n              </button>\n            </li>\n          \n        </ul>\n      </div>\n\n      <div>\n        <div class=\"tab-content\">\n          <div role=\"tabpanel\" class=\"tab-pane fade show active\" id=\"challenge\">\n            <h2 class=\"challenge-name text-center pt-3\">\n              Bootkit\n            </h2>\n            <h3 class=\"challenge-value text-center\">\n              500\n            </h3>\n\n\n            \n              <div class=\"challenge-tags text-center pt-2 pb-3\">\n                \n                  \n                    <span class=\"challenge-tag badge bg-info\">pwn</span>\n                  \n                    <span class=\"challenge-tag badge bg-info\">uefi</span>\n                  \n                    <span class=\"challenge-tag badge bg-info\">extreme</span>\n                  \n                \n              </div>\n            \n\n            <small class=\"challenge-attribution text-center text-muted\">\n              \n            </small>\n\n            <span class=\"challenge-desc\"><p>Many years later, in a galaxy far far away, the Empire of UIUCTF was collecting UEFI patches for their secret lab machines, and stumbled upon the remains of SIGPwny Inc. and PwnySIG Inc. Not knowing the dangers, they installed both patch sets to their super secure lab machines, with TPM-sealed disk encryption protecting their latest research (flag).</p>\n<p>As the lead security officer of the rebellion against the Empire, you need their research to expose the Empire of their anti-droid vendetta. Unfortunately, you discovered that the Empire designed the secret disks such that they detach themselves as soon as any keyboard input is detected during boot, and since you need the keyboard to install the bootkit, the bootkit must survive the reboot. TPM also hashes everything on the boot disk and there's no hope of keeping the bootkit there.</p>\n<p>That leaves only one option, completely and utterly pwning the firmware...</p>\n<p>Lua.efi, but with persistance. SMM is Asleep, but with purpose.</p>\n<p><code>$ socat file:$(tty),raw,echo=0 openssl:bootkit.chal.uiuc.tf:1337</code></p>\n<details><summary>Show hint #1</summary>UEFIReplace from https://github.com/LongSoft/UEFITool/tree/old_engine is\n  installed remotely in the initramfs, so you don't need to transfer\n  megabytes of data though serial.</details>\n<details><summary>Show hint #2</summary>Command entered into /proc/sys/kernel/run_command will be run by initrd.\n  Without, one could spawn processes by writing to kernel data structs\n  (or modprobe_path I guess) since you have arbitrary kernel write anyways...</details>\n<details><summary>Show hint #3</summary>KASLR is off. With KASLR one could just easily compute the offset from the\n  call stack.</details>\n<details><summary>Show hint #4</summary>PCR 0 and 1 are not measured. If they were, one could feed TPM with fake\n  hashes since system boot, considering you have arbitrary CFI flash write\n  anyways... I mean, who said the hashes has to be of a real blob?\n  [<a href=\"https://github.com/tianocore/edk2/blob/8be9a344d35316fb0ee70a33779a7a931fcb8a1d/SecurityPkg/Library/Tpm2CommandLib/Tpm2Integrity.c#L92\" target=\"_blank\" rel=\"noopener noreferrer\">1</a>]\n  [<a href=\"https://github.com/stefanberger/libtpms/blob/7dfe310f06cc188187807d36e4786458e3e14e86/src/tpm2/IntegrityCommands.c#L66\" target=\"_blank\" rel=\"noopener noreferrer\">2</a>]\n  [<a href=\"https://github.com/microsoft/ms-tpm-20-ref/blob/ee21db0a941decd3cac67925ea3310873af60ab3/TPMCmd/tpm/src/command/PCR/PCR_Extend.c\" target=\"_blank\" rel=\"noopener noreferrer\">3</a>]\n  [<a href=\"https://github.com/tpm2-software/tpm2-tools/blob/112f0e547a7a83d625b585e506449a185e9268cc/man/tpm2_pcrextend.1.md\" target=\"_blank\" rel=\"noopener noreferrer\">4</a>]\n  [<a href=\"https://trustedcomputinggroup.org/wp-content/uploads/Trusted-Platform-Module-2.0-Library-Part-3-Version-184_pub.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">5</a>, Section 22.2]\n</details>\n<p><strong>author</strong>: YiFei Zhu</p>\n</span>\n\n            \n\n            \n\n            \n              <div class=\"row challenge-files text-center pb-3\">\n                \n                  <div class=\"col-md-4 col-sm-4 col-xs-12 file-button-wrapper d-block\">\n                    \n                    \n                    \n                      \n                    \n                    <a\n                        class=\"btn btn-info btn-file mb-1 d-inline-block px-2 w-100 text-truncate\"\n                        href=\"/files/b19107423e272aea8b88d2c6874f2a59/README\"\n                        title=\"README\"\n                    >\n                      <i class=\"fas fa-download\"></i>\n                      <small>\n                        README\n                      </small>\n                    </a>\n                  </div>\n                \n                  <div class=\"col-md-4 col-sm-4 col-xs-12 file-button-wrapper d-block\">\n                    \n                    \n                    \n                      \n                    \n                    <a\n                        class=\"btn btn-info btn-file mb-1 d-inline-block px-2 w-100 text-truncate\"\n                        href=\"/files/38c2c5b227cd51d4066f9de76b44b2ea/chal_build.tar.zst\"\n                        title=\"chal_build.tar.zst\"\n                    >\n                      <i class=\"fas fa-download\"></i>\n                      <small>\n                        chal_build.tar.zst\n                      </small>\n                    </a>\n                  </div>\n                \n                  <div class=\"col-md-4 col-sm-4 col-xs-12 file-button-wrapper d-block\">\n                    \n                    \n                    \n                      \n                    \n                    <a\n                        class=\"btn btn-info btn-file mb-1 d-inline-block px-2 w-100 text-truncate\"\n                        href=\"/files/d35e21ac35d29459bd9865ca5f879e0e/edk2_artifacts.tar.zst\"\n                        title=\"edk2_artifacts.tar.zst\"\n                    >\n                      <i class=\"fas fa-download\"></i>\n                      <small>\n                        edk2_artifacts.tar.zst\n                      </small>\n                    </a>\n                  </div>\n                \n                  <div class=\"col-md-4 col-sm-4 col-xs-12 file-button-wrapper d-block\">\n                    \n                    \n                    \n                      \n                    \n                    <a\n                        class=\"btn btn-info btn-file mb-1 d-inline-block px-2 w-100 text-truncate\"\n                        href=\"/files/2609db59107ad05cfdebc51505174e00/linux-headers.tar.zst\"\n                        title=\"linux-headers.tar.zst\"\n                    >\n                      <i class=\"fas fa-download\"></i>\n                      <small>\n                        linux-headers.tar.zst\n                      </small>\n                    </a>\n                  </div>\n                \n                  <div class=\"col-md-4 col-sm-4 col-xs-12 file-button-wrapper d-block\">\n                    \n                    \n                    \n                      \n                    \n                    <a\n                        class=\"btn btn-info btn-file mb-1 d-inline-block px-2 w-100 text-truncate\"\n                        href=\"/files/58d066d46be6e9d060795870ce3b5f20/run.tar.zst\"\n                        title=\"run.tar.zst\"\n                    >\n                      <i class=\"fas fa-download\"></i>\n                      <small>\n                        run.tar.zst\n                      </small>\n                    </a>\n                  </div>\n                \n                  <div class=\"col-md-4 col-sm-4 col-xs-12 file-button-wrapper d-block\">\n                    \n                    \n                    \n                      \n                    \n                    <a\n                        class=\"btn btn-info btn-file mb-1 d-inline-block px-2 w-100 text-truncate\"\n                        href=\"/files/976eefc56c7ecf084a61d79956672722/vmlinux.zst\"\n                        title=\"vmlinux.zst\"\n                    >\n                      <i class=\"fas fa-download\"></i>\n                      <small>\n                        vmlinux.zst\n                      </small>\n                    </a>\n                  </div>\n                \n              </div>\n            \n\n            <template x-if=\"max_attempts > 0\">\n              <p class=\"text-center\">\n                <span x-text=\"attempts\"></span>/<span x-text=\"max_attempts\"></span> attempts\n              </p>\n            </template>\n\n            <div class=\"row submit-row\">\n              <div class=\"col-12 col-sm-8\">\n                \n                  <input\n                      id=\"challenge-id\" class=\"challenge-id\" type=\"hidden\"\n                      value=\"9\"\n                  >\n                  <input\n                      id=\"challenge-input\" class=\"challenge-input form-control\"\n                      type=\"text\" name=\"submission\"\n                      @keyup.enter=\"submitChallenge()\"\n                      placeholder=\"Flag\" x-model=\"submission\"\n                  >\n                \n              </div>\n\n              <div class=\"col-12 col-sm-4 mt-3 mt-sm-0 key-submit\">\n                \n                  <button\n                      id=\"challenge-submit\"\n                      class=\"challenge-submit btn btn-outline-secondary w-100 h-100\" type=\"submit\"\n                      @click.debounce.500ms=\"submitChallenge()\"\n                  >\n                    Submit\n                  </button>\n                \n              </div>\n            </div>\n\n            <div class=\"row notification-row\">\n              <div class=\"col-12\">\n                <template x-if=\"response\">\n                  \n                  <div class=\"alert text-center w-100 mt-3\"\n                      :class=\"{\n                        'alert-success': response.data.status == 'correct',\n                        'alert-info': response.data.status == 'already_solved',\n                        'alert-danger': response.data.status == 'incorrect',\n                        'alert-warning': response.data.status == 'paused',\n                      }\" role=\"alert\"\n                  >\n                    <strong x-text=\"response.data.message\"></strong>\n                    <div x-show=\"(response.data.status == 'correct' || response.data.status == 'already_solved')\">\n                      <div x-show=\"getNextId()\">\n                        <button @click=\"nextChallenge()\" class=\"btn btn-info mt-3\">\n                          Next Challenge\n                        </button>\n                      </div>\n                      \n                    </div>\n                  </div>\n                </template>\n              </div>\n            </div>\n          </div>\n\n          <div role=\"tabpanel\" class=\"tab-pane fade\" id=\"solves\">\n            <div class=\"row\">\n              <div class=\"col-md-12\">\n                <table class=\"table table-striped align-middle text-center\">\n                  <thead>\n                  <tr>\n                    <th>Name</th>\n                    <th>Date</th>\n                  </tr>\n                  </thead>\n                  <tbody id=\"challenge-solves-names\">\n                  <template x-for=\"solve in solves\">\n                    <tr>\n                      <td>\n                        <a :href=\"solve.account_url\" x-text=\"solve.name\"></a>\n                      </td>\n                      <td x-text=\"solve.date\"></td>\n                    </tr>\n                  </template>\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>"}}
