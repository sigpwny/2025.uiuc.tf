import{i as X,a as P}from"./props.Bj6o9DXP.js";import{o as Y}from"./index-client.DbL1ygyQ.js";import{p as Z,s as a,v as B,w as ee,x as ae,q as D,a as v,b as te,m as c,g as r,f as w,c as b,d as i,r as s,t as E}from"./template.DA8Zrd-d.js";import{s as S}from"./render.BJRwOoAD.js";import{e as re,i as se}from"./each.Bk1PdW2q.js";import{e as ie}from"./utils.D8_OE2hv.js";import{i as oe,g as ne,s as $,h as p}from"./ctfd.svelte.CUWNQAoX.js";import{P as ce}from"./PixelarticonsAlert.fWHFY1WR.js";import{P as le}from"./PixelarticonsCheck.B5U_5lp2.js";import"./router.DnZMHVsn.js";import"./attributes.BwuaZUqp.js";var de=w('<div class="bg-green-600 p-4 mb-4"><div class="flex flex-row gap-2 items-center text-sm text-white"><!> <span> </span></div></div>'),fe=w("<span> </span>"),me=w('<div class="bg-red-700 p-4 mb-4"><div class="flex flex-row gap-2 items-center text-sm text-white"><!> <div class="flex flex-col gap-1"></div></div></div>'),ue=w('<!> <!> <button class="flex flex-row items-center gap-2 font-mono font-bold text-lg px-3 py-1 bg-text text-surface-000 cursor-pointer hover:opacity-50 disabled:opacity-50 disabled:cursor-not-allowed"><span> </span></button>',1);function Pe(j,z){Z(z,!1);const g=c(),R="";let l=c(!1),y=c([]),F=c(""),d=c(!1),_=c(!1),T=c(!1);Y(async()=>{await oe(),a(T,!0)});function G(){return typeof window>"u"?null:new URLSearchParams(window.location.search).get("token")}function H(){a(_,!1),a(d,!1),a(y,[])}function x(e){a(y,e),a(d,!0),a(_,!1)}function A(e){a(F,e),a(_,!0),a(d,!1)}async function I(){H(),a(l,!0);try{let e=await ne();$.ctfd.auth.postConfirm({baseUrl:R,headers:{"CSRF-Token":e}}).then(t=>{t.data.redirect?p(t.data.redirect):t.data.success&&t.data.message&&A(t.data.message)}).catch(t=>{t.data.redirect?p(t.data.redirect):(console.error("Error resending confirmation:",t),r(d)||x(["An unexpected error occurred. Please try again."]))}).finally(()=>{a(l,!1)})}catch(e){console.error("Error getting CSRF token:",e),x(["An unexpected error occurred. Please try again."]),a(l,!1)}}B(()=>{},()=>{a(g,G())}),B(()=>(r(g),p),()=>{r(g)&&$.ctfd.auth.getConfirm(r(g),{baseUrl:R}).then(e=>{e.ok&&e.data.success?(A("Email confirmed successfully!"),e.data.redirect&&p(e.data.redirect)):x(["Failed to confirm email. Please try again."])}).catch(e=>{e.data.redirect?p(e.data.redirect):(console.error("Error confirming email:",e),x(["An unexpected error occurred. Please try again."]))})}),ee(),X();var U=ae(),J=D(U);{var K=e=>{var t=ue(),M=D(t);{var N=o=>{var n=de(),f=i(n),m=i(f);le(m,{class:"w-5 h-5"});var u=b(m,2),k=i(u,!0);s(u),s(f),s(n),E(()=>S(k,r(F))),v(o,n)};P(M,o=>{r(_)&&o(N)})}var L=b(M,2);{var O=o=>{var n=me(),f=i(n),m=i(f);ce(m,{class:"w-5 h-5"});var u=b(m,2);re(u,5,()=>r(y),se,(k,V)=>{var C=fe(),W=i(C,!0);s(C),E(()=>S(W,r(V))),v(k,C)}),s(u),s(f),s(n),v(o,n)};P(L,o=>{r(d)&&o(O)})}var h=b(L,2),q=i(h),Q=i(q,!0);s(q),s(h),E(()=>{h.disabled=r(l),S(Q,r(l)?"Sending...":"Resend Confirmation Email")}),ie("click",h,I),v(e,t)};P(J,e=>{r(T)&&e(K)})}v(j,U),te()}export{Pe as default};
